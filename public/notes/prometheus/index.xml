<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>prometheus监控学习 on GUAN-BLOG</title>
    <link>https://academia-hugo.netlify.com/notes/prometheus/</link>
    <description>Recent content in prometheus监控学习 on GUAN-BLOG</description>
    <generator>Source Themes academia (https://sourcethemes.com/academic/)</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 25 Aug 2020 00:00:00 +0000</lastBuildDate>
    
	    <atom:link href="https://academia-hugo.netlify.com/notes/prometheus/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>普罗米修斯安装</title>
      <link>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E5%AE%89%E8%A3%85/</link>
      <pubDate>Tue, 16 Jun 2020 00:00:00 +0100</pubDate>
      
      <guid>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E5%AE%89%E8%A3%85/</guid>
      <description>&lt;h2 id=&#34;启动node-exporter&#34;&gt;启动node-exporter&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;docker run -d -p 9100:9100 \
  -v &amp;quot;/proc:/host/proc:ro&amp;quot; \
  -v &amp;quot;/sys:/host/sys:ro&amp;quot; \
  -v &amp;quot;/:/rootfs:ro&amp;quot; \
  --net=&amp;quot;host&amp;quot; \
  prom/node-exporter
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;等待几秒钟，查看端口是否起来了&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@ubuntu:~# netstat -anpt
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1147/sshd       
tcp        0     36 192.168.91.132:22       192.168.91.1:63648      ESTABLISHED 2969/0          
tcp        0      0 192.168.91.132:22       192.168.91.1:63340      ESTABLISHED 1321/1          
tcp6       0      0 :::9100                 :::*                    LISTEN      3070/node_exporter
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;访问url：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://192.168.91.132:9100/metrics
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;效果如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://img2018.cnblogs.com/blog/1341090/201811/1341090-20181108172459066-1268369984.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;这些都是收集到数据，有了它就可以做数据展示了&lt;/p&gt;
&lt;h2 id=&#34;启动prometheus&#34;&gt;启动prometheus&lt;/h2&gt;
&lt;p&gt;新建目录prometheus，编辑配置文件prometheus.yml&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir /opt/prometheus
cd /opt/prometheus/
vim prometheus.yml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;内容如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;global:
  scrape_interval:     60s
  evaluation_interval: 60s
 
scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: [&#39;localhost:9090&#39;]
        labels:
          instance: prometheus
 
  - job_name: linux
    static_configs:
      - targets: [&#39;192.168.91.132:9100&#39;]
        labels:
          instance: localhost
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;注意：修改IP地址，这里的192.168.91.132就是本机地址&lt;/p&gt;
&lt;p&gt;启动prometheus&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run  -d \
  -p 9090:9090 \
  -v /opt/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml  \
  prom/prometheus
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;等待几秒钟，查看端口状态&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;root@ubuntu:/opt/prometheus# netstat -anpt
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1147/sshd       
tcp        0     36 192.168.91.132:22       192.168.91.1:63648      ESTABLISHED 2969/0          
tcp        0      0 192.168.91.132:22       192.168.91.1:63340      ESTABLISHED 1321/1          
tcp6       0      0 :::9100                 :::*                    LISTEN      3070/node_exporter
tcp6       0      0 :::22                   :::*                    LISTEN      1147/sshd       
tcp6       0      0 :::9090                 :::*                    LISTEN      3336/docker-proxy
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;访问url：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;http://192.168.91.132:9090/graph
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;启动grafana&#34;&gt;启动grafana&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://grafana.com/grafana/download?platform=linux&#34;&gt;https://grafana.com/grafana/download?platform=linux&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; systemctl start grafana-server
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;docker&lt;/p&gt;
&lt;p&gt;新建空文件夹grafana-storage，用来存储数据&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkdir /opt/grafana-storage
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;设置权限&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod 777 -R /opt/grafana-storage
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因为grafana用户会在这个目录写入文件，直接设置777，比较简单粗暴！&lt;/p&gt;
&lt;p&gt;启动grafana&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run -d \
  -p 3000:3000 \
  --name=grafana \
  -v /opt/grafana:/var/lib/grafana \
  grafana/grafana:5.3.4
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;docker安装mysql_exporter&#34;&gt;docker安装mysql_exporter&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;下载mysql_exporter镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;docker pull prom/mysqld-exporter
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;mysql_exporter需要链接数据库，mysql创建mysql_monitor用户，添加PROCESS, REPLICATION CLIENT权限&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mysql_exporter需要链接数据库，mysql创建mysql_monitor用户，添加PROCESS, REPLICATION CLIENT权限&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;mysql&amp;gt; INSERT INTO mysql.user&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Host,User,Password&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; VALUES&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;localhost&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mysql_monitor&amp;#34;&lt;/span&gt;, password&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mysql_monitor&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;))&lt;/span&gt;; 
mysql&amp;gt; GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql_monitor&amp;#39;&lt;/span&gt;@&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt; IDENTIFIED BY &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql_monitor&amp;#39;&lt;/span&gt;;
mysql&amp;gt; GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql_monitor&amp;#39;&lt;/span&gt;@&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;%&amp;#39;&lt;/span&gt; IDENTIFIED BY &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mysql_monitor&amp;#39;&lt;/span&gt;;
mysql&amp;gt; FLUSH PRIVILEGES;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;docker启动mysql_exporter镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;docker run -d -p 9104:9104 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;mysqld-exporter &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  --restart&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;always &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  -e DATA_SOURCE_NAME&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;mysql_monitor:mysql_monitor@(172.17.0.1:3306)/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  prom/mysqld-exporter
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;修改prometheus.yml文件&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;vim prometheus.yml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- job_name: mysql
    static_configs:
      - targets: [&#39;203.176.95.155:9104&#39;]
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>普罗米修斯监控告警</title>
      <link>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/</link>
      <pubDate>Tue, 25 Aug 2020 00:00:00 +0100</pubDate>
      
      <guid>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/</guid>
      <description>&lt;p&gt;官网&lt;a href=&#34;https://newuser.aiops.com/&#34;&gt;https://newuser.aiops.com/&lt;/a&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/5.jpg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/6.jpg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/7.jpg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/8.jpg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/9.jpg&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img src=&#34;https://academia-hugo.netlify.com/img/prometheus/10.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>普罗米修斯监控docker</title>
      <link>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7docker/</link>
      <pubDate>Tue, 16 Jun 2020 00:00:00 +0100</pubDate>
      
      <guid>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7docker/</guid>
      <description>&lt;h2 id=&#34;安装cadvisor&#34;&gt;安装cadvisor&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;docker run   --volume&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/:/rootfs:ro   --volume&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/var/run:/var/run:rw   --volume&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/sys:/sys:ro   --volume&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/apps/docker/:/var/lib/docker:ro   --volume&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/dev/disk/:/dev/disk:ro   --publish&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;9101:8080   --detach&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true   --name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cadvisor   google/cadvisor:latest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;修改prometheus配置&#34;&gt;修改prometheus配置&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;  - job_name: docker 
    static_configs: 
      - targets: [&#39;203.176.95.155:9101&#39;]

&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;可视化&#34;&gt;可视化&lt;/h2&gt;
&lt;p&gt;docker 监控仪表盘193&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>普罗米修斯监控MYSQL</title>
      <link>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7mysql/</link>
      <pubDate>Tue, 16 Jun 2020 00:00:00 +0100</pubDate>
      
      <guid>https://academia-hugo.netlify.com/notes/prometheus/%E6%99%AE%E7%BD%97%E7%B1%B3%E4%BF%AE%E6%96%AF%E7%9B%91%E6%8E%A7mysql/</guid>
      <description>&lt;p&gt;官网&lt;a href=&#34;https://github.com/percona/grafana-dashboards&#34;&gt;https://github.com/percona/grafana-dashboards&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
