---
title: 【MyBatis笔记】工作日志-矫正系统操行统计
categories: MyBatis笔记
tags:
  - MyBatis
  - 左连接
  - 工作日志
  - SUN函数
  - IFNULL函数
excerpt: 矫正系统操行统计
date: 2020-12-21 20:33:36
img:  /images/Mybatis/mybatis.png
---
## 表说明
- correction_behaviors_review ：操行记录表
- correction_student : 学生表
## 需求
根据周ID学生所属班级ID统计操行分不及格，及格，良好，优秀的人数。每个学生每周初始操行分为60分

BehaviorsReviewMapper.java
```java
public interface BehaviorsReviewMapper extends BaseMapper<BehaviorsReviewEntity> {

    /**
     * 操行周统计
     * @param weekId  周ID
     * @param classId 班级ID
     * @return
     */
    public Map<String, Object> weeklyStatistics(@Param("weekId") String weekId, @Param("classId")String classId);

}
```
BehaviorsReviewMapper.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alinesno.school.correction.platform.mapper.BehaviorsReviewEntity">

    <select id="weeklyStatistics" parameterType="string" resultType="Map">
        SELECT
        count( IF ( score >= 71, TRUE, NULL ) ) AS yx,
        count( IF ( 71 > score AND score >= 65, TRUE, NULL ) ) AS lh,
        count( IF ( 65 > score AND score >= 60, TRUE, NULL ) ) AS hg,
        count( IF ( 60 > score, TRUE, NULL ) ) AS bjg
        FROM
        (
        SELECT
        60+ IFNULL( SUM( bonus ) - IFNULL( SUM( deduction ), '0' ), '0' ) AS score
        FROM
        correction_student a
        LEFT JOIN correction_behaviors_review b ON a.id = b.student_id
        <if test="weekId != null and weekId !=''">
            AND week_id = #{ weekId }
        </if>
        WHERE
        a.`status`=2
        <if test="classId != null and classId !=''">
            AND student_class_id = #{ classId }
        </if>

        GROUP BY
        a.id
        ) AS weekly_score
    </select>
</mapper>
```





