---
title:  支付模块构建
linktitle: 支付模块构建
toc: true
type: docs
date: "2020-06-28T00:00:00+01:00"
draft: false
menu:
 cloud-study:
    parent: SpringCloud微服务学习
    weight: 2
---

giteehttps://gitee.com/MrPen/springcloud2020_microservices/tree/master/com-yzg-springcloud

##  建module

新建cloud.provider.payment8001项目  



## 改POM   

pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<artifactId>com-yzg-springcloud</artifactId>
		<groupId>com.yzg.springcloud</groupId>
		<version>1.0-SNAPSHOT</version>
	</parent>

	<artifactId>cloud.provider.payment8001</artifactId>
	<description>支付模块</description>


	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>com.alibaba</groupId>
			<artifactId>druid-spring-boot-starter</artifactId>
		</dependency>
		<!--mysql-connector-java -->
		<dependency>
			<groupId>mysql</groupId>
			<artifactId>mysql-connector-java</artifactId>
		</dependency>
		<!--jdbc -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-jdbc</artifactId>
		</dependency>
		<!--热部署 -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>
		<!--lombok -->
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
		</dependency>
		<!-- mybatis -->
		<dependency>
			<groupId>org.mybatis.spring.boot</groupId>
			<artifactId>mybatis-spring-boot-starter</artifactId>
		</dependency>
		<dependency>
			  <groupId>log4j</groupId>
              <artifactId>log4j</artifactId>
		</dependency>
	<dependency>
		<groupId>cn.hutool</groupId>
		<artifactId>hutool-all</artifactId>
	</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

</project>
```

解决 Failure to transfer * from http://repo1.maven.org/maven2 
Failure to transfer org.apache.maven:maven-archiver:pom:2.4.1 from http://repo1.maven.org/maven2 was cached in the local repository  

**原因**
maven下载jar中断没成功。  

**解决办法** 
1.将当前用户目录下的`.m2`目录下所有以 .lastupdate 结尾的文件全部删除掉

2.maven-->> update project  

## 写YML

application.yml

```
server:
  port: 8001
spring:
  application:
    name: cloud-payment-service
  datasource:
    # 当前数据源操作类型
    type: com.alibaba.druid.pool.DruidDataSource
    # mysql驱动类
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/cloud2020?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=GMT%2B8
    username: root
    password: admin
mybatis:
  type-aliases-package: com.cloud.provider.payment.entities

#showSql
logging:
  level:
    com:
      example:
        mapper : debug

```

## 启动类

```java
package com.cloud.provider.payment;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
@SpringBootApplication
@MapperScan("com.cloud.provider.payment.dao")
public class PaymentMain8001 {
    public static void main(String[] args) {
        SpringApplication.run(PaymentMain8001.class, args);
    }
}
```



## 写业务

entities

```java
package com.cloud.provider.payment.entities;

public class Payment {
private Long id;
private String serial;

public Long getId() {
	return id;
}

public void setId(Long id) {
	this.id = id;
}

public String getSerial() {
	return serial;
}

public void setSerial(String serial) {
	this.serial = serial;
}

@Override
public String toString() {
	return "Payment [id=" + id + ", serial=" + serial + "]";
}

}

```

dao

```java
package com.cloud.provider.payment.dao;

import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;

import com.cloud.provider.payment.entities.Payment;

@Mapper
public interface PaymentMapper {
	/**
	 * 新增
	 * 
	 * @param payment
	 * @return
	 */
 	 @Insert("insert into payment(id,serial) value(#{id},#{serial})")
 	 int save(Payment payment);

	/**
	 * 查询
	 * 
	 * @param id
	 * @return
	 */
 	 @Select("select * from payment where id = #{id} ")
	 Payment findById(@Param("id") Long id);

}
```

service

```java
package com.cloud.provider.payment.service;

import org.apache.ibatis.annotations.Param;

import com.cloud.provider.payment.entities.Payment;

public interface PaymentService {
	/**
	 * 新增
	 * 
	 * @param payment
	 * @return
	 */
	public int save(Payment payment);

	/**
	 * 查询
	 * 
	 * @param id
	 * @return
	 */
	public Payment findById(@Param("id") Long id);
}

```

serviceimpl

```java
package com.cloud.provider.payment.service.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cloud.provider.payment.entities.Payment;
import com.cloud.provider.payment.dao.PaymentMapper;
import com.cloud.provider.payment.service.PaymentService;
@Service
public class PaymentServiceImpl implements PaymentService{
    @Autowired
	private PaymentMapper paymentDao;
    
	@Override
	public int save(Payment payment) {
		// TODO Auto-generated method stub
		return paymentDao.save(payment);
	}

	@Override
	public Payment findById(Long id) {
		// TODO Auto-generated method stub
		return paymentDao.findById(id);
	}

}

```

controller

```java
package com.cloud.provider.payment.contrller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.cloud.provider.payment.entities.CommomResult;
import com.cloud.provider.payment.entities.Payment;
import com.cloud.provider.payment.service.PaymentService;

import cn.hutool.json.JSONObject;
import cn.hutool.json.JSONUtil;
import lombok.extern.slf4j.Slf4j;

@Controller
@Slf4j
public class PaymentController {
	@Autowired
	private PaymentService paymentService;

	private static final Logger log = LoggerFactory.getLogger(PaymentController.class);
	
	@ResponseBody
	@PostMapping(value = "/payment/save")
	public JSONObject save(Payment payment) {
		CommomResult commomResult=new CommomResult();
		try {
			int result = paymentService.save(payment);
			if (result > 0) {
				commomResult.setCode(200);
				commomResult.setData(result);
				commomResult.setMassage("插入数据库成功");
			} else {
				commomResult.setCode(400);
				commomResult.setMassage("插入数据库失败");
			}
		}catch (Exception e) {
			commomResult.setCode(400);
			commomResult.setMassage("插入数据库失败");
		}
		
		return  JSONUtil.parseObj(commomResult, true);
	}
	@ResponseBody
	@GetMapping(value = "/payment/get/{id}")
	public JSONObject findById(@PathVariable("id")Long id) {
		Payment result = paymentService.findById(id);
		CommomResult commomResult=new CommomResult();
		
		if (result != null) {
			commomResult.setCode(200);
			commomResult.setData(result);
			commomResult.setMassage("查询成功");
		} else {
			commomResult.setCode(400);
			commomResult.setMassage("查询为空");
		}
		return  JSONUtil.parseObj(commomResult, true);
	}
}

```

## 测试

http://localhost:8001/payment/get/1

![](/img/springCloud/7.jpg)

http://localhost:8001/payment/get/3

![](/img/springCloud/8.jpg)

http://localhost:8001//payment/save?id=3&serial=测试数据

![](/img/springCloud/9.jpg)

http://localhost:8001//payment/save?id=3&serial=测试数据

![](/img/springCloud/10.jpg)