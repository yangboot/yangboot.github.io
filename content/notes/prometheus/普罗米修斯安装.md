---
title: 普罗米修斯安装
linktitle: 普罗米修斯安装
toc: true
type: docs
date: "2020-06-16T00:00:00+01:00"
draft: false
menu:
  prometheus:
    parent: prometheus监控学习
    weight: 1

# Prev/next pager order (if `docs_section_pager` enabled in `params.toml`)
weight: 2
---

## 启动node-exporter



```
docker run -d -p 9100:9100 \
  -v "/proc:/host/proc:ro" \
  -v "/sys:/host/sys:ro" \
  -v "/:/rootfs:ro" \
  --net="host" \
  prom/node-exporter
```



 

等待几秒钟，查看端口是否起来了



```
root@ubuntu:~# netstat -anpt
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1147/sshd       
tcp        0     36 192.168.91.132:22       192.168.91.1:63648      ESTABLISHED 2969/0          
tcp        0      0 192.168.91.132:22       192.168.91.1:63340      ESTABLISHED 1321/1          
tcp6       0      0 :::9100                 :::*                    LISTEN      3070/node_exporter
```



 

访问url：

```
http://192.168.91.132:9100/metrics
```

 

效果如下：

![img](https://img2018.cnblogs.com/blog/1341090/201811/1341090-20181108172459066-1268369984.png)

 

这些都是收集到数据，有了它就可以做数据展示了

 

## 启动prometheus

新建目录prometheus，编辑配置文件prometheus.yml

```
mkdir /opt/prometheus
cd /opt/prometheus/
vim prometheus.yml
```

 

内容如下：



```
global:
  scrape_interval:     60s
  evaluation_interval: 60s
 
scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: prometheus
 
  - job_name: linux
    static_configs:
      - targets: ['192.168.91.132:9100']
        labels:
          instance: localhost
```



 

注意：修改IP地址，这里的192.168.91.132就是本机地址

 

启动prometheus

```
docker run  -d \
  -p 9090:9090 \
  -v /opt/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml  \
  prom/prometheus
```

 

等待几秒钟，查看端口状态



```
root@ubuntu:/opt/prometheus# netstat -anpt
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1147/sshd       
tcp        0     36 192.168.91.132:22       192.168.91.1:63648      ESTABLISHED 2969/0          
tcp        0      0 192.168.91.132:22       192.168.91.1:63340      ESTABLISHED 1321/1          
tcp6       0      0 :::9100                 :::*                    LISTEN      3070/node_exporter
tcp6       0      0 :::22                   :::*                    LISTEN      1147/sshd       
tcp6       0      0 :::9090                 :::*                    LISTEN      3336/docker-proxy
```



 

访问url：

```
http://192.168.91.132:9090/graph
```

## 启动grafana

https://grafana.com/grafana/download?platform=linux

```
 systemctl start grafana-server
```

docker  

新建空文件夹grafana-storage，用来存储数据

```
mkdir /opt/grafana-storage
```

设置权限

```
chmod 777 -R /opt/grafana-storage
```

因为grafana用户会在这个目录写入文件，直接设置777，比较简单粗暴！

 

启动grafana

```
docker run -d \
  -p 3000:3000 \
  --name=grafana \
  -v /opt/grafana:/var/lib/grafana \
  grafana/grafana:5.3.4
```

### docker安装mysql_exporter


- 下载mysql_exporter镜像

```
docker pull prom/mysqld-exporter
```

- mysql_exporter需要链接数据库，mysql创建mysql_monitor用户，添加PROCESS, REPLICATION CLIENT权限

- mysql_exporter需要链接数据库，mysql创建mysql_monitor用户，添加PROCESS, REPLICATION CLIENT权限

```bash
mysql> INSERT INTO mysql.user(Host,User,Password) VALUES("localhost", "mysql_monitor", password("mysql_monitor")); 
mysql> GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'mysql_monitor'@'localhost' IDENTIFIED BY 'mysql_monitor';
mysql> GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'mysql_monitor'@'%' IDENTIFIED BY 'mysql_monitor';
mysql> FLUSH PRIVILEGES;
```

- docker启动mysql_exporter镜像

```bash
docker run -d -p 9104:9104 \
  --name=mysqld-exporter \
  --restart=always \
  -e DATA_SOURCE_NAME="mysql_monitor:mysql_monitor@(172.17.0.1:3306)/" \
  prom/mysqld-exporter
```

- 修改prometheus.yml文件

```
vim prometheus.yml
```

添加

```
- job_name: mysql
    static_configs:
      - targets: ['203.176.95.155:9104']
```



