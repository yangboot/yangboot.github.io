---
title: dockerfile案例
linktitle: dockerfile案例
toc: true
type: docs
date: "2020-06-24T00:00:00+01:00"
draft: false
menu:
 docker-study:
    parent: docker
    weight: 6
---

### 在centos内构建centos容器，并在容器内安装jdk和tomcat

`将apache-tomcat-9.0.36.tar.gz`和`jdk-8u112-linux-x64.tar.gz`复制到`/mydocker`

![](/img/docker/33.jpg)


编写dockerFile
vim dockerFile
```shell
FROM centos
MAINTAINER  YZG@qq.com
#把宿主机当前上下文的c.txt拷贝到容器/user/local/路径下
COPY c.txt /user/local/cincontainer.txt
#把Java与tomcat添加到容器中
ADD jdk-8u112-linux-x64.tar.gz  /user/local/
ADD apache-tomcat-9.0.36.tar.gz /user/local/
#安装VIM编辑器
RUN yum -y install vim
#设置工作访问时候的WORKDIR路径，登录的落脚点
ENV MYPATH /user/local/
WORKDIR $MYPATH
#配置java与tomcat环境变量
ENV JAVA_HOME /user/local/jdk1.8.0_112
ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
ENV CATALINA_HOME /user/local/apache-tomcat-9.0.36
ENV CATALINA_BASE /user/local/apache-tomcat-9.0.36
ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin
#容器运行时监听的端口
EXPOSE 8080
#启动时运行Tomcat
#ENTRYPOINT ["/user/local/apache-tomcat-9.0.36/bin/startup.sh"]
#CMD["/user/local/apache-tomcat-9.0.36/bin/catalina.sh","run"]
CMD /user/local/apache-tomcat-9.0.36/bin/startup.sh && tail -F /user/local/apache-tomcat-9.0.36/bin/logs/catalina.out
```
![](/img/docker/34.jpg)

### 构建容器
```shell
docker build -f dockerFile . -t mycentos
```
![](/img/docker/1.gif)

### 运行容器
```shell
docker run -d -p 18080:8080 --name mycentos 
-v /mytomcat/test:/user/local/apache-tomcat-9.0.36/webapps/test 
-v /mytomcat/logs:/user/local/apache-tomcat-9.0.36/logs 
--privileged=true  mycentos
```
运行成功！！！

![](/img/docker/35.jpg)

### 部署简单的web项目

2.1.在宿主机的`/mytomcat/test`文件下新建`WEB-INF`文件夹
2.在`WEB-INF`文件夹下新建`web.xml`
3.在`/mytomcat/test`下新建`index.jsp`

4.编写web.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">
<web-app>
    <display-name>myapp</display-name>
    <description>This a description of my web app made by Eclipse</description>
    <welcome-file-list>
        <welcome-file>index.jsp</welcome-file>
    </welcome-file-list>
</web-app>
```
5.编写index.jsp
```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <body>
<h1>
dockerFile successful!!!!!! </h1>
  </body>
</html>
```

6.重启容器
```shell
docker restart  8ab8846816c0
```
7.运行成功
![](/img/docker/36.jpg)

### 在宿主机上查看docker容器下tomcat日志
```shell
cat /mytomcat/logs/catalina.out
```
![](/img/docker/37.jpg)


